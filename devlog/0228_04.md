# 0228_04 — 实现窗口拖拽移动（点击卡片拖动窗口）

**日期**: 2026-02-28  
**Owner**: AI_Delta  
**状态**: Research

---

## 问题现状

当前窗口配置为 `decorations: false`（无标题栏）+ `transparent: true`（透明背景），因此没有系统标题栏供用户拖拽移动窗口。窗口每次唤醒后都居中显示，用户无法通过鼠标拖拽将其移到屏幕上的其他位置。

**用户期望**：鼠标点击卡片（非交互元素区域）可以拖动窗口移动位置。

---

## 底层原因分析

1. `tauri.conf.json` 中 `decorations: false` 去掉了系统原生标题栏，失去了拖拽区域。
2. 前端没有任何元素声明为可拖拽区域（缺少 `data-tauri-drag-region` 属性或 `startDragging()` 调用）。
3. `capabilities/default.json` 中未配置 `core:window:allow-start-dragging` 权限，即使添加拖拽属性也可能因权限不足而无效。

---

## 预期的改动点

### 方案：使用 `data-tauri-drag-region` 属性

Tauri v2 原生支持 `data-tauri-drag-region` HTML 属性——将其添加到容器元素上后，鼠标在该元素（及其非交互子元素）上按下拖拽即可移动窗口。交互元素（button、input、textarea、select 等）会自动排除，不会触发拖拽。

#### 改动文件清单

| 文件 | 改动内容 |
|---|---|
| `src/components/layout/FlipCard.tsx` | 在最外层容器 `<div>` 上添加 `data-tauri-drag-region` 属性 |
| `src-tauri/capabilities/default.json` | 添加 `"core:window:allow-start-dragging"` 权限 |

#### 具体改动

**1. `FlipCard.tsx` — 添加 drag region**

```tsx
// Before:
<div
  className="relative flex min-h-full w-full items-center justify-center p-4"
  style={{ perspective: 1200 }}
>

// After:
<div
  data-tauri-drag-region
  className="relative flex min-h-full w-full items-center justify-center p-4"
  style={{ perspective: 1200 }}
>
```

**2. `capabilities/default.json` — 添加拖拽权限**

在 `permissions` 数组中添加一行：
```json
"core:window:allow-start-dragging"
```

---

## 冲突分析

| 任务 ID | 状态 | 冲突文件 | 影响评估 |
|---|---|---|---|
| 0228_02 | In Progress | `src-tauri/capabilities/default.json` | 0228_02 需修改 capabilities 添加托盘权限。本任务仅追加一行权限声明，改动互不干扰，可安全并行。 |
| 0228_03 | Research | `src/components/layout/FlipCard.tsx` | 0228_03 计划调整翻转动画参数和结构。本任务仅在最外层 div 添加一个属性，不触碰动画逻辑，冲突风险极低。 |

**结论**: 两处冲突均为低风险追加式修改（添加属性 / 添加权限行），不影响其他任务的代码逻辑。建议与用户确认后直接实施。

---

## 潜在风险

1. **拖拽区域过大** — `data-tauri-drag-region` 放在最外层 div 上意味着卡片外围的 padding 区域也可以拖，这是期望行为（方便用户操作），但需确认不会与未来的 UI 元素冲突。
2. **权限缺失** — 如果 `core:window:allow-start-dragging` 未添加，拖拽功能静默失效（无报错），需通过测试确认权限生效。
