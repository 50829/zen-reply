# 0228_05: 自定义角色按钮/输入框宽度自适应

## 问题现状

`RoleComposer.tsx` 中自定义角色区域的外层容器设置了 `min-w-[170px]`，导致：
- 编辑状态下 input 始终占据 170px+ 宽度，输入少量文字时右侧大量留白。
- 非编辑状态下 button 也被撑到 170px，与其他预设角色按钮风格不一致。

## 底层原因分析

`motion.div` 容器的 `min-w-[170px] max-w-full` 加上子元素 `w-full`，使得无论内容多少，组件始终保持 170px 最小宽度。

## 预期的改动点

1. **移除固定 `min-w-[170px]`**，让容器宽度由内容驱动。
2. **Input 自适应宽度**：使用隐藏 `<span>` 测量文字宽度，动态设置 input 的 `width`，最小宽度 `2em`（约 2 个中文字宽）。
3. **Button 自然宽度**：移除 `w-full`，按钮由内容自然撑开。
4. **保留动画**：`layout` + `AnimatePresence` 在宽度变化时提供平滑过渡。

## 实际改动记录

文件：`src/components/zenreply/RoleComposer.tsx`

1. 新增 import: `useState`, `useCallback`
2. 新增 state/ref: `measurerRef` (隐藏 span), `inputWidth` (计算出的宽度)
3. 新增常量: `PLACEHOLDER_TEXT`, `INPUT_PADDING` (30px), `MIN_INPUT_WIDTH` (24px ≈ 2em)
4. 新增 `measureWidth` 回调: 读取 span 的 `offsetWidth` → `setInputWidth(max(textWidth + padding, minWidth + padding))`
5. 新增 effect: 当 `isCustomRoleEditing` 或 `customRoleDraft` 变化时触发 `measureWidth`
6. 移除容器 `min-w-[170px]`，改为仅 `max-w-full`
7. 容器 `style` 在编辑态动态设置 `{ width: inputWidth }`，非编辑按钮由内容自然撑开
8. 新增隐藏 `<span>` 镜像输入文字（空时用 placeholder），`text-xs whitespace-pre` 与 input 字号一致

## 潜在风险

- 隐藏 span 使用 `fixed` 定位不触发布局，但如果全局字体大小变化可能需要重新测量。
- `offsetWidth` 为整数像素，极端情况下可能差 1px（影响极小）。
